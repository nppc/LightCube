C51 COMPILER V9.60.0.0   BUTTON                                                            10/05/2025 20:50:29 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE BUTTON
OBJECT MODULE PLACED IN .\src\button.OBJ
COMPILER INVOKED BY: C:\SiliconLabs\SimplicityStudio\v5_2\developer\toolchains\keil_8051\9.60\BIN\C51.exe C:\src\tennp\g
                    -it\LightCube\Firmware\LightCube\src\button.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY(3) OPTI
                    -MIZE(8,SPEED) DEFINE(DEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(C:/SiliconLabs/SimplicityStudio/v5_2/developer/sdks/80
                    -51/v4.3.1//Device/EFM8BB50/inc;C:/SiliconLabs/SimplicityStudio/v5_2/developer/sdks/8051/v4.3.1//Device/shared/si8051Base
                    -) PRINT(.\src\button.lst) COND PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src\button.OBJ)

line level    source

   1          /*
   2           * button.c
   3           *
   4           *  Created on: Oct 5, 2025
   5           *      Author: Pavel
   6           */
   7          
   8          #include "main.h"
   9          #include "button.h"
  10          #include "status_led.h"
  11          
  12          ButtonState button_state = BUTTON_IDLE;
  13          uint8_t debounce_counter = 0;
  14          uint16_t press_duration = 0;
  15          
  16          void process_button(void) {
  17   1          switch (button_state) {
  18   2              case BUTTON_IDLE:
  19   2                  if (PIN_BUT == 1) {
  20   3                      button_state = BUTTON_DEBOUNCE;
  21   3                      debounce_counter = BUTTON_DEBOUNCE_TIME;
  22   3                  }
  23   2                  break;
  24   2      
  25   2              case BUTTON_DEBOUNCE:
  26   2                  if (debounce_counter > 0) {
  27   3                      debounce_counter--;
  28   3                  } else {
  29   3                      if (PIN_BUT == 1) {
  30   4                          button_state = BUTTON_PRESSED;
  31   4                          press_duration = 0;
  32   4                          led_cmd = LED_CMD_BUTTON_PRESS;  // LED ON
  33   4                      } else {
  34   4                          button_state = BUTTON_IDLE;
  35   4                      }
  36   3                  }
  37   2                  break;
  38   2      
  39   2              case BUTTON_PRESSED:
  40   2                  if (PIN_BUT == 1) {
  41   3                      if (press_duration < BUTTON_LONG_PRESS_TIME) {
  42   4                          press_duration++;
  43   4                      } else {
  44   4                          // Long press confirmed
  45   4                          led_cmd = LED_CMD_POWEROFF;  // LED OFF after 1.5s
  46   4                          poweroff_trigger = 1;        // Signal to start power-off routine
  47   4                          button_state = BUTTON_RELEASED;
  48   4                      }
  49   3                  } else {
  50   3                      // Released before long press
  51   3                      led_cmd = LED_CMD_SHORTPRESS;
  52   3                      button_state = BUTTON_IDLE;
C51 COMPILER V9.60.0.0   BUTTON                                                            10/05/2025 20:50:29 PAGE 2   

  53   3                  }
  54   2                  break;
  55   2      
  56   2              case BUTTON_RELEASED:
  57   2                  if (PIN_BUT == 0) {
  58   3                      button_state = BUTTON_IDLE;
  59   3                  }
  60   2                  break;
  61   2          }
  62   1      }
  63          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     98    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
