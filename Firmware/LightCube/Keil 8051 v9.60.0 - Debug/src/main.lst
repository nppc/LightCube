C51 COMPILER V9.60.0.0   MAIN                                                              11/14/2025 11:34:20 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\src\main.OBJ
COMPILER INVOKED BY: C:\SiliconLabs\SimplicityStudio\v5\developer\toolchains\keil_8051\9.60\BIN\C51.exe C:\src\tennp\git
                    -\LightCube\Firmware\LightCube\src\main.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY(3) OPTIMIZE
                    -(8,SPEED) DEFINE(DEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(C:/SiliconLabs/SimplicityStudio/v5/developer/sdks/8051/v4.
                    -3.1//Device/EFM8BB50/inc;C:/SiliconLabs/SimplicityStudio/v5/developer/sdks/8051/v4.3.1//Device/shared/si8051Base) PRINT(
                    -.\src\main.lst) COND PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src\main.OBJ)

line level    source

   1          //#pragma src
   2          //-----------------------------------------------------------------------------
   3          // Includes
   4          //-----------------------------------------------------------------------------
   5          #include "main.h"
   6          #include "InitDevice.h"
   7          #include "status_led.h"
   8          #include "button.h"
   9          #include "pwm.h"
  10          #include "candle.h"
  11          
  12          //volatile uint16_t tmp_millis;
  13          //volatile uint16_t butcntr;
  14          //volatile bit delay_on;
  15          volatile U16_U8 pwm_channels[4];
  16          
  17          bit effect_trigger = 0;
  18          uint8_t ambient_level; // Default to max brightness
  19          uint16_t brightness_correction;
  20          bit poweroff_trigger = 0;  // Set to 1 when power-off should begin
  21          
  22          
  23          //-----------------------------------------------------------------------------
  24          // SiLabs_Startup() Routine
  25          // ----------------------------------------------------------------------------
  26          // This function is called immediately after reset, before the initialization
  27          // code is run in SILABS_STARTUP.A51 (which runs before main() ). This is a
  28          // useful place to disable the watchdog timer, which is enable by default
  29          // and may trigger before main() in some instances.
  30          //-----------------------------------------------------------------------------
  31          void SiLabs_Startup(void) {
  32   1        // $[SiLabs Startup]
  33   1        // [SiLabs Startup]$
  34   1      }
  35          
  36          //-----------------------------------------------------------------------------
  37          // main() Routine
  38          // ----------------------------------------------------------------------------
  39          int main(void) {
  40   1        enter_DefaultMode_from_RESET();
  41   1      
  42   1          SFRPAGE = 0x10;
  43   1          PWMCFG0 = PWMCFG0_PWMMODE__EDGE | PWMCFG0_PWMCLKEN__ENABLE | PWMCFG0_SYNCUPD__CH0CH1CH2;
  44   1      //    PWMCFG1 = PWMCFG1_DTIEN__ENABLE |
  45   1          PWMCFG2 = PWMCFG2_CNTRZERO__ZERO;
  46   1          PWMLIML = 0xFF;
  47   1          PWMLIMH = 0xFF;
  48   1          PWMCFG1 = PWMCFG1_PWMLTSYS__GTSYSCK | PWMCFG1_PWMEN__ENABLE; // start PWM0
  49   1          SFRPAGE = 0x00;
  50   1      
  51   1        PCA0CN0_CR = PCA0CN0_CR__RUN; // Start PCA0 after config is done
  52   1      
C51 COMPILER V9.60.0.0   MAIN                                                              11/14/2025 11:34:20 PAGE 2   

  53   1        set_pwm(0, 0, 0);
  54   1        set_pwm(1, 0, 0);
  55   1        set_pwm(2, 0, 0);
  56   1        set_pwm(3, 0, 0);
  57   1      
  58   1        IE_EA = 1;
  59   1      
  60   1        rand_set(getRAW_Ambient()); // set initial seed for rand
  61   1      
  62   1        PIN_BUT = 1;
  63   1      
  64   1        PIN_LED = 0;
  65   1        while(PIN_BUT); // wait until button is depressed
  66   1      
  67   1        led_cmd = LED_CMD_INIT;
  68   1      
  69   1        setBrightnessLevel(5);
  70   1        candle_init();
  71   1      
  72   1      
  73   1        while(1){
  74   2            uint16_t ambient = getRAW_Ambient();
  75   2      
  76   2            if(effect_trigger){
  77   3                effect_trigger = 0;
  78   3                candle_tick();
  79   3                process_button();
  80   3                update_status_led(led_cmd);
  81   3            }
  82   2      
  83   2            if (poweroff_trigger) {
  84   3                bit fade_finished = 0;
  85   3                PIN_LED = 1;
  86   3                start_poweroff_sequence();
  87   3                while(!fade_finished){
  88   4                    if(effect_trigger){
  89   5                        effect_trigger = 0;
  90   5                        fade_finished = process_fadeout();
  91   5                    }
  92   4                }
  93   3                // go to powerdown
  94   3                while(PIN_BUT);
  95   3                delay_ms(100);
  96   3                PIN_BUT = 0;
  97   3                REG0CN = REG0CN_STOPCF__SHUTDOWN;
  98   3                PCON0 = PCON0_STOP__STOP;
  99   3            }
 100   2      
 101   2        }
 102   1      
 103   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    159    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      2       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
C51 COMPILER V9.60.0.0   MAIN                                                              11/14/2025 11:34:20 PAGE 3   

   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
