C51 COMPILER V9.60.0.0   MAIN                                                              10/03/2025 22:34:59 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\src\main.OBJ
COMPILER INVOKED BY: C:\SiliconLabs\SimplicityStudio\v5_2\developer\toolchains\keil_8051\9.60\BIN\C51.exe C:\src\tennp\g
                    -it\LightCube\Firmware\LightCube\src\main.c OMF2 SMALL DEBUG OBJECTEXTEND ROM(LARGE) WARNINGLEVEL(2) FLOATFUZZY(3) OPTIMI
                    -ZE(8,SPEED) DEFINE(DEBUG=1) INTVECTOR(0X0000) INTPROMOTE INCDIR(C:/SiliconLabs/SimplicityStudio/v5_2/developer/sdks/8051
                    -/v4.3.1//Device/EFM8BB50/inc;C:/SiliconLabs/SimplicityStudio/v5_2/developer/sdks/8051/v4.3.1//Device/shared/si8051Base) 
                    -PRINT(.\src\main.lst) COND PAGEWIDTH(120) PAGELENGTH(65) OBJECT(.\src\main.OBJ)

line level    source

   1          //#pragma src
   2          //-----------------------------------------------------------------------------
   3          // Includes
   4          //-----------------------------------------------------------------------------
   5          #include "main.h"
   6          #include "InitDevice.h"
   7          #include "candle.h"
   8          
   9          //volatile uint16_t tmp_millis;
  10          //volatile uint16_t butcntr;
  11          //volatile bit delay_on;
  12          volatile U16_U8 pwm_channels[4];
  13          
  14          bit effect_trigger = 0;
  15          uint8_t ambient_level = 9; // Default to max brightness
  16          
  17          
  18          //-----------------------------------------------------------------------------
  19          // SiLabs_Startup() Routine
  20          // ----------------------------------------------------------------------------
  21          // This function is called immediately after reset, before the initialization
  22          // code is run in SILABS_STARTUP.A51 (which runs before main() ). This is a
  23          // useful place to disable the watchdog timer, which is enable by default
  24          // and may trigger before main() in some instances.
  25          //-----------------------------------------------------------------------------
  26          void SiLabs_Startup(void) {
  27   1        // $[SiLabs Startup]
  28   1        // [SiLabs Startup]$
  29   1      }
  30          
  31          //-----------------------------------------------------------------------------
  32          // main() Routine
  33          // ----------------------------------------------------------------------------
  34          int main(void) {
  35   1        enter_DefaultMode_from_RESET();
  36   1      
  37   1          SFRPAGE = 0x10;
  38   1          PWMCFG0 = PWMCFG0_PWMMODE__EDGE | PWMCFG0_PWMCLKEN__ENABLE | PWMCFG0_SYNCUPD__CH0CH1CH2;
  39   1      //    PWMCFG1 = PWMCFG1_DTIEN__ENABLE |
  40   1          PWMCFG2 = PWMCFG2_CNTRZERO__ZERO;
  41   1          PWMLIML = 0xFF;
  42   1          PWMLIMH = 0xFF;
  43   1          PWMCFG1 = PWMCFG1_PWMLTSYS__GTSYSCK | PWMCFG1_PWMEN__ENABLE; // start PWM0
  44   1          SFRPAGE = 0x00;
  45   1      
  46   1        PCA0CN0_CR = PCA0CN0_CR__RUN; // Start PCA0 after config is done
  47   1      
  48   1        set_pwm(0, 0);
  49   1        set_pwm(1, 0);
  50   1        set_pwm(2, 0);
  51   1        set_pwm(3, 0);
  52   1      
C51 COMPILER V9.60.0.0   MAIN                                                              10/03/2025 22:34:59 PAGE 2   

  53   1        IE_EA = 1;
  54   1      
  55   1      
  56   1        { // INIT LED Sequence
  57   2          uint8_t i;
  58   2          for(i=0;i<3;i++){
  59   3            PIN_LED = 0;
  60   3            delay_ms(200);
  61   3            PIN_LED = 1;
  62   3            delay_ms(200);
  63   3           }
  64   2        }
  65   1      
  66   1        rand_set(getRAW_Ambient()); // set initial seed for rand
  67   1      
  68   1        PIN_BUT = 1;
  69   1      
  70   1      //  setAmbientLevel(7);
  71   1        candle_init();
  72   1      
  73   1      
  74   1        while(1){
  75   2            uint16_t ambient = getRAW_Ambient();
  76   2      
  77   2            if(effect_trigger){
  78   3                effect_trigger = 0;
  79   3                //Efect4_routine();
  80   3                candle_tick();
  81   3            }
  82   2      
  83   2      
  84   2            if(PIN_BUT){
  85   3                uint8_t i;
  86   3                bit shutdown = 1;
  87   3                PIN_LED = 0;
  88   3                delay_ms(200);
  89   3                for(i=0;i<12;i++){
  90   4                    delay_ms(100);
  91   4                    if(!PIN_BUT) {
  92   5                        shutdown = 0;
  93   5                        break;
  94   5                    }
  95   4                }
  96   3                PIN_LED = 1;
  97   3                if(shutdown){
  98   4                    set_pwm(0, 0);
  99   4                    set_pwm(1, 0);
 100   4                    set_pwm(2, 0);
 101   4                    set_pwm(3, 0);
 102   4                    while(PIN_BUT);
 103   4                    delay_ms(300);
 104   4                    PIN_BUT = 0;
 105   4                    //PCON1 = PCON1_PINRETAIN__RETAIN;
 106   4                    REG0CN = REG0CN_STOPCF__SHUTDOWN;
 107   4                    PCON0 = PCON0_STOP__STOP;
 108   4                }
 109   3            }
 110   2      
 111   2        }
 112   1      
 113   1      }


C51 COMPILER V9.60.0.0   MAIN                                                              10/03/2025 22:34:59 PAGE 3   

MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    223    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      9       3
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1       1
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
